<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聯華電子 (2303.TW) 深度財務穿透報告 | 互動儀表板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
            color: #1e293b; /* Slate 800 */
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            height: 350px;
            max-width: 100%;
        }

        /* Custom Slider */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb; /* Blue 600 */
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #cbd5e1; /* Slate 300 */
            border-radius: 3px;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
    <!-- 
    Application Structure Plan:
    1. Header: Report Title, Stock Code, Key Ticker info.
    2. Executive Summary: Thesis cards (Specialty Process, Geopolitics, Edge AI).
    3. Floor Test (Section 4.1): Visualizing the downside protection from backlog.
    4. Interactive Valuation Model (Section 4.2): Sliders for Revenue/Margin -> Dynamic EPS & Target Prices.
    5. PE Matrix Chart (Section 5): Visualizing current price vs valuation bands.
    6. Revenue Monitor (Section 6): Table check for monthly run-rate.
    7. Insights & Conclusion: Accordion for deep dive & final verdict.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 pb-12">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 text-white p-2 rounded-lg">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-900 leading-tight">聯華電子 (2303.TW)</h1>
                        <p class="text-xs text-slate-500">深度財務穿透報告 | 2026 前瞻</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-slate-500">報告基準價</div>
                    <div class="font-mono font-bold text-slate-800 text-lg">54.10 <span class="text-xs font-normal text-slate-400">TWD</span></div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- 1. Executive Summary Cards -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-slate-800"><i class="fas fa-layer-group text-blue-500 mr-2"></i>核心投資論點 (Thesis)</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Card 1 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-hover relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-blue-500"><i class="fas fa-shield-alt"></i></div>
                    <h3 class="font-bold text-slate-800 mb-2 text-lg">特殊製程護城河</h3>
                    <p class="text-sm text-slate-600 leading-relaxed mb-4">
                        22/28nm 營收佔比 >35%，避開中國 40/55nm 紅海殺價。HV 與 BCD 製程擁有技術溢價，有效支撐毛利率在 30% 水準。
                    </p>
                    <div class="flex items-center gap-2 text-xs font-medium text-blue-600 bg-blue-50 w-fit px-2 py-1 rounded">
                        <i class="fas fa-arrow-up"></i> 定價權重塑
                    </div>
                </div>
                <!-- Card 2 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-hover relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-green-500"><i class="fas fa-globe"></i></div>
                    <h3 class="font-bold text-slate-800 mb-2 text-lg">地緣政治紅利</h3>
                    <p class="text-sm text-slate-600 leading-relaxed mb-4">
                        China+1 策略最大受益者。新加坡 Fab 12i 擴建精準對接歐美長約需求，確保 2026 年產能利用率。
                    </p>
                    <div class="flex items-center gap-2 text-xs font-medium text-green-600 bg-green-50 w-fit px-2 py-1 rounded">
                        <i class="fas fa-check"></i> 去風險化首選
                    </div>
                </div>
                <!-- Card 3 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-hover relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-purple-500"><i class="fas fa-brain"></i></div>
                    <h3 class="font-bold text-slate-800 mb-2 text-lg">AI 邊緣運算隱形贏家</h3>
                    <p class="text-sm text-slate-600 leading-relaxed mb-4">
                        矽光子與 CoWoS 中介層佈局雖然目前貢獻有限，但將是推動本益比從 12x 提升至 16x 的關鍵催化劑。
                    </p>
                    <div class="flex items-center gap-2 text-xs font-medium text-purple-600 bg-purple-50 w-fit px-2 py-1 rounded">
                        <i class="fas fa-rocket"></i> 價值重估 (Re-rating)
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Floor Test & Data Verification -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Floor Test Visualization -->
            <div class="bg-slate-800 text-white rounded-2xl p-6 shadow-lg flex flex-col justify-between relative overflow-hidden">
                <div class="z-10">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg"><i class="fas fa-anchor text-yellow-400 mr-2"></i>地板防禦測試 (Floor Test)</h3>
                        <span class="bg-slate-700 text-xs px-2 py-1 rounded">極端情境</span>
                    </div>
                    <div class="mb-6">
                        <div class="text-xs text-slate-400 mb-1">合約負債 (訂單代理)</div>
                        <div class="text-2xl font-mono font-bold">325.2 <span class="text-sm text-slate-400">億元</span></div>
                    </div>
                    
                    <div class="bg-slate-700 rounded-lg p-4 mb-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-slate-300">保底 EPS 貢獻</span>
                            <span class="font-bold text-yellow-400">0.44 元</span>
                        </div>
                        <div class="w-full bg-slate-600 rounded-full h-2.5">
                            <div class="bg-yellow-400 h-2.5 rounded-full" style="width: 13%"></div>
                        </div>
                        <div class="text-xs text-slate-400 mt-2 text-right">佔全年預估 13%</div>
                    </div>
                    
                    <p class="text-xs text-slate-400 leading-relaxed border-t border-slate-700 pt-4">
                        <i class="fas fa-info-circle mr-1"></i> 洞察：聯電屬「即時訂單流 (Run-rate)」模式，帳面負債僅代表訂金。雖數值低，但確立了基本的現金流底氣。
                    </p>
                </div>
            </div>

            <!-- Parameters Check -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-4"><i class="fas fa-search-dollar text-blue-500 mr-2"></i>模型參數校準 (Data Verification)</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">股本結構</h4>
                        <div class="flex justify-between items-center py-2 border-b border-slate-100">
                            <span class="text-sm text-slate-600">稀釋後股數</span>
                            <span class="font-mono font-bold text-slate-800">125.56 億股</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-100">
                            <span class="text-sm text-slate-600">每股面額</span>
                            <span class="font-mono text-slate-800">10 元</span>
                        </div>
                        <div class="mt-2 text-xs text-green-600"><i class="fas fa-check-circle mr-1"></i>已計入 CB 潛在稀釋</div>
                    </div>
                    <div>
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">獲利能力 (近四季)</h4>
                        <div class="flex justify-between items-center py-2 border-b border-slate-100">
                            <span class="text-sm text-slate-600">2025 Q3 淨利率</span>
                            <span class="font-mono text-slate-800">25.27% (含業外)</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-100 bg-blue-50 px-2 rounded">
                            <span class="text-sm text-blue-800 font-bold">模型設定基準</span>
                            <span class="font-mono font-bold text-blue-800">16.93%</span>
                        </div>
                        <div class="mt-2 text-xs text-slate-500">排除一次性業外，反映本業真實水平</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Interactive Financial Model -->
        <section class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
            <div class="p-6 bg-slate-50 border-b border-slate-200 flex flex-col sm:flex-row justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-slate-800"><i class="fas fa-calculator text-blue-600 mr-2"></i>2026 極限 EPS 預測模型</h2>
                    <p class="text-sm text-slate-500 mt-1">請調整下方參數，模擬不同情境對目標價的影響</p>
                </div>
                <button onclick="resetToConsensus()" class="mt-4 sm:mt-0 text-sm bg-white border border-slate-300 px-4 py-2 rounded-lg shadow-sm hover:bg-slate-50 transition text-slate-600 font-medium">
                    <i class="fas fa-sync-alt mr-2"></i>重置為法人共識
                </button>
            </div>

            <div class="p-6 grid grid-cols-1 lg:grid-cols-12 gap-10">
                <!-- Sliders Control -->
                <div class="lg:col-span-5 space-y-8">
                    <!-- Revenue Slider -->
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <label class="font-bold text-slate-700">預估 2026 營收 (億元)</label>
                            <span id="display-revenue" class="text-2xl font-mono font-bold text-blue-600">2428</span>
                        </div>
                        <input type="range" id="input-revenue" min="2300" max="2600" step="10" value="2428" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-slate-400 mt-2 font-medium">
                            <span>保守 (2350)</span>
                            <span>共識 (2428)</span>
                            <span>樂觀 (2550)</span>
                        </div>
                    </div>

                    <!-- Margin Slider -->
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <label class="font-bold text-slate-700">預估淨利率 (%)</label>
                            <span id="display-margin" class="text-2xl font-mono font-bold text-blue-600">17.6%</span>
                        </div>
                        <input type="range" id="input-margin" min="15.0" max="20.0" step="0.1" value="17.6" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-slate-400 mt-2 font-medium">
                            <span>折舊壓力 (16.0%)</span>
                            <span>基準 (17.6%)</span>
                            <span>產品優化 (19.0%)</span>
                        </div>
                    </div>

                    <!-- Calculated Result Card -->
                    <div class="bg-slate-900 text-white rounded-xl p-6 shadow-inner relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-blue-500 rounded-full filter blur-3xl opacity-20 -mr-10 -mt-10"></div>
                        <div class="relative z-10">
                            <div class="text-sm text-slate-400 mb-1">模型推算 2026 EPS</div>
                            <div class="text-4xl font-bold text-white mb-4"><span id="result-eps">3.40</span> <span class="text-sm font-normal text-slate-400">元</span></div>
                            
                            <div class="space-y-3 pt-4 border-t border-slate-700">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">合理目標價 (13x)</span>
                                    <span class="font-bold text-blue-400 text-lg" id="target-fair">44.2</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">樂觀目標價 (15.5x)</span>
                                    <span class="font-bold text-red-400 text-lg" id="target-bull">52.7</span>
                                </div>
                                <div class="flex justify-between items-center mt-2 bg-slate-800 p-2 rounded">
                                    <span class="text-xs text-slate-300">當前股價 (54.10) 狀態</span>
                                    <span class="font-bold text-xs px-2 py-0.5 rounded" id="valuation-status">計算中...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization: PE River Chart -->
                <div class="lg:col-span-7 flex flex-col">
                    <h3 class="font-bold text-slate-700 mb-2 text-center">本益比評價河流圖 (PE Valuation Matrix)</h3>
                    <p class="text-xs text-center text-slate-400 mb-4">視覺化呈現股價與估值區間的關係</p>
                    <div class="chart-container bg-white rounded-xl border border-slate-100 p-2 flex-grow">
                        <canvas id="valuationChart"></canvas>
                    </div>
                    <div class="flex justify-center gap-4 mt-4 text-xs text-slate-500">
                        <span class="flex items-center"><span class="w-2 h-2 rounded-full bg-green-400 mr-1"></span>保守 (10.5x)</span>
                        <span class="flex items-center"><span class="w-2 h-2 rounded-full bg-gray-400 mr-1"></span>合理 (13.0x)</span>
                        <span class="flex items-center"><span class="w-2 h-2 rounded-full bg-red-400 mr-1"></span>樂觀 (15.5x)</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Revenue Checkpoint & Insights -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Revenue Monitor -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold text-slate-800"><i class="fas fa-clipboard-check text-green-500 mr-2"></i>營收達標檢查表</h2>
                    <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">2026 月均目標: 202.35 億</span>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-600 uppercase font-medium text-xs">
                            <tr>
                                <th class="px-4 py-3 rounded-tl-lg">月份</th>
                                <th class="px-4 py-3">監控標準 (億)</th>
                                <th class="px-4 py-3">實際數值</th>
                                <th class="px-4 py-3 rounded-tr-lg">狀態</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr>
                                <td class="px-4 py-3 font-medium text-slate-800">2025-12</td>
                                <td class="px-4 py-3 text-slate-500">195.0</td>
                                <td class="px-4 py-3 font-bold text-slate-700">192.8</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold">略低 (98.9%)</span></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-slate-800">2026-01 (預估)</td>
                                <td class="px-4 py-3 text-slate-500">195.0 - 200.0</td>
                                <td class="px-4 py-3 text-slate-400 italic">待公布</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 bg-slate-100 text-slate-500 rounded text-xs">觀察中</span></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-slate-800">2026-02 (預估)</td>
                                <td class="px-4 py-3 text-slate-500">185.0 - 190.0</td>
                                <td class="px-4 py-3 text-slate-400 italic">待公布</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 bg-slate-100 text-slate-500 rounded text-xs">春節效應</span></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-slate-800">2026-03 (預估)</td>
                                <td class="px-4 py-3 text-slate-500">210.0+</td>
                                <td class="px-4 py-3 text-slate-400 italic">待公布</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">復甦確認點</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-xs text-slate-500 bg-slate-50 p-3 rounded">
                    <strong>操作指引：</strong>若連續兩個月實際數值低於監控標準 > 5%，建議切換上方模型至「保守情境」(預估 EPS 2.99)。
                </div>
            </section>

            <!-- Second-Order Insights -->
            <section class="space-y-4">
                <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-lightbulb text-yellow-400 mr-2"></i>第二層次洞察 (Deep Insights)</h2>
                
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm transition hover:border-blue-300 group">
                    <h3 class="font-bold text-slate-700 mb-1 group-hover:text-blue-600 transition">折舊費用的雙面刃</h3>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        雖然 2025-26 折舊增加，但毛利率守住 29.8% 傳遞了重要訊號：新產能是被高單價訂單（Wi-Fi 7, OLED DDIC）填滿的。一旦折舊高峰過去，毛利將暴力回升。
                    </p>
                </div>

                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm transition hover:border-purple-300 group">
                    <h3 class="font-bold text-slate-700 mb-1 group-hover:text-purple-600 transition">矽光子：從題材到實質</h3>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        聯電不與台積電爭奪最高階 CoWoS，而是鎖定性價比更高的中介層與矽光子平台。這將是本益比從 12x 重估至 16x 的核心驅動力。
                    </p>
                </div>

                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm transition hover:border-green-300 group">
                    <h3 class="font-bold text-slate-700 mb-1 group-hover:text-green-600 transition">匯率隱形槓桿</h3>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        營收收美元、成本付台幣。若強勢美元延續，這將成為毛利率的隱形支撐。每一分貶值都是純利。
                    </p>
                </div>
            </section>
        </div>

        <!-- 5. Conclusion -->
        <section class="bg-slate-900 text-white rounded-2xl p-8 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-900 to-slate-900 opacity-50"></div>
            <div class="relative z-10 max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold mb-4">結論與操作建議</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left mb-6">
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <div class="text-xs text-slate-400 mb-1">價值定位</div>
                        <div class="font-bold text-yellow-400 text-lg">樂觀定價中</div>
                        <p class="text-xs text-slate-400 mt-2">15.9x PE 已反映復甦預期</p>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <div class="text-xs text-slate-400 mb-1">長期持有者</div>
                        <div class="font-bold text-green-400 text-lg">續抱 (Hold)</div>
                        <p class="text-xs text-slate-400 mt-2">殖利率約 5.5%，防禦性佳</p>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <div class="text-xs text-slate-400 mb-1">空手投資人</div>
                        <div class="font-bold text-red-400 text-lg">等待拉回</div>
                        <p class="text-xs text-slate-400 mt-2">建議買點 45-48 元 (13x PE)</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center text-slate-400 text-xs py-8">
            <p>© 2026 AI Investment Analysis System. 本報告僅供財務模型研究，不構成投資建議。</p>
            <p>資料來源：2025 Q3 財報、法人共識、市場公開資訊。</p>
        </footer>

    </main>

    <script>
        // --- Constants & Data ---
        const SHARES = 125.56; // Billion Shares
        const CURRENT_PRICE = 54.10; // Per report section 5.2 and Conclusion
        
        // Base Scenario
        const BASE_REV = 2428;
        const BASE_MARGIN = 17.6;

        let chartInstance = null;

        // --- Model Logic ---
        function updateModel() {
            const rev = parseFloat(document.getElementById('input-revenue').value);
            const margin = parseFloat(document.getElementById('input-margin').value);

            // Update UI Labels
            document.getElementById('display-revenue').innerText = rev;
            document.getElementById('display-margin').innerText = margin.toFixed(1) + '%';

            // Calculate EPS
            // Formula: (Revenue * Margin%) / Shares
            const eps = (rev * (margin / 100)) / SHARES;
            const epsFixed = eps.toFixed(2);

            // Update Result Display
            document.getElementById('result-eps').innerText = epsFixed;
            
            // Update Targets
            const pFair = (eps * 13.0).toFixed(1); // 13x Mean
            const pBull = (eps * 15.5).toFixed(1); // 15.5x +1SD
            
            document.getElementById('target-fair').innerText = pFair;
            document.getElementById('target-bull').innerText = pBull;

            // Update Valuation Status Badge
            const statusEl = document.getElementById('valuation-status');
            const optimisticPrice = eps * 15.5;
            const fairPrice = eps * 13.0;

            if (CURRENT_PRICE > optimisticPrice) {
                statusEl.innerText = "過熱 (Overheated)";
                statusEl.className = "font-bold text-xs px-2 py-0.5 rounded bg-red-500 text-white";
            } else if (CURRENT_PRICE > fairPrice) {
                statusEl.innerText = "偏高 (Optimistic)";
                statusEl.className = "font-bold text-xs px-2 py-0.5 rounded bg-yellow-500 text-black";
            } else {
                statusEl.innerText = "低估 (Undervalued)";
                statusEl.className = "font-bold text-xs px-2 py-0.5 rounded bg-green-500 text-white";
            }

            // Trigger Chart Update
            updateChart(eps);
        }

        function resetToConsensus() {
            document.getElementById('input-revenue').value = BASE_REV;
            document.getElementById('input-margin').value = BASE_MARGIN;
            updateModel();
        }

        // --- Chart Logic ---
        function initChart() {
            const ctx = document.getElementById('valuationChart').getContext('2d');
            
            // Labels: Historical + Model Year
            const labels = ['2022', '2023', '2024', '2025(E)', '2026(Model)'];
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '樂觀 (15.5x)',
                            data: [65, 55, 58, 51, 0], // Last point dynamic
                            borderColor: 'rgba(239, 68, 68, 0.6)', 
                            backgroundColor: 'rgba(239, 68, 68, 0.05)',
                            fill: '+1',
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '合理 (13.0x)',
                            data: [55, 46, 48, 43, 0], 
                            borderColor: 'rgba(107, 114, 128, 0.6)', 
                            backgroundColor: 'rgba(107, 114, 128, 0.05)',
                            fill: '+1',
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '保守 (10.5x)',
                            data: [45, 37, 39, 35, 0], 
                            borderColor: 'rgba(34, 197, 94, 0.6)', 
                            backgroundColor: 'rgba(34, 197, 94, 0.05)',
                            fill: 'start',
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '股價 (Price)',
                            data: [58, 48, 52, 53, CURRENT_PRICE], // 54.10 static from report
                            borderColor: '#1e293b', 
                            borderWidth: 2,
                            borderDash: [4, 4],
                            fill: false,
                            tension: 0.1,
                            pointStyle: 'circle',
                            pointRadius: 5,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#fff'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { usePointStyle: true, boxWidth: 8, font: { size: 10 } }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 30,
                            max: 70,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function updateChart(currentEPS) {
            if (!chartInstance) return;

            const pOptimistic = currentEPS * 15.5;
            const pFair = currentEPS * 13.0;
            const pConservative = currentEPS * 10.5;

            const lastIdx = 4;
            chartInstance.data.datasets[0].data[lastIdx] = pOptimistic;
            chartInstance.data.datasets[1].data[lastIdx] = pFair;
            chartInstance.data.datasets[2].data[lastIdx] = pConservative;
            chartInstance.data.datasets[3].data[lastIdx] = CURRENT_PRICE;

            chartInstance.update();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            document.getElementById('input-revenue').addEventListener('input', updateModel);
            document.getElementById('input-margin').addEventListener('input', updateModel);
            // Initial run
            updateModel();
        });

    </script>
</body>
</html>
